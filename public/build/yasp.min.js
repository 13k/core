function generateActivity(a){function b(a,b,d){if(void 0!==b.index){var e=d[b.index]&&d[b.index].win?d[b.index].win/d[b.index].games:0,f=.4,g=.6,h=g-f,i=Math.max(f,Math.min(e,g));e=(i-f)/h;var j=Math.floor(120*e),k=1,l=1,m=c(j,k,l);return m}return a}function c(a,b,c){var d,e,f=[];if(0===b)d=[c,c,c];else switch(a/=60,e=Math.floor(a),f=[c*(1-b),c*(1-b*(a-e)),c*(1-b*(1-(a-e)))],e){case 0:d=[c,f[2],f[0]];break;case 1:d=[f[1],c,f[0]];break;case 2:d=[f[0],c,f[2]];break;case 3:d=[f[0],f[1],c];break;case 4:d=[f[2],f[0],c];break;default:d=[c,f[0],f[1]]}return"#"+d.map(function(a){return("0"+Math.round(255*a).toString(16)).slice(-2)}).join("")}for(var d={},e={},f={},g=0;7>g;g++)e[g]={win:0,games:0};for(var g=0;24>g;g++)f[g]={win:0,games:0};for(var h in a){d[h]=1;var i=moment(h,"X").day(),j=moment(h,"X").hours();e[i].games+=1,e[i].win+=a[h]?1:0,f[j].games+=1,f[j].win+=a[h]?1:0}var k=new CalHeatMap;k.init({start:new Date(moment().subtract(1,"year")),itemSelector:"#cal-heatmap",range:13,domain:"month",subDomain:"day",data:d,verticalOrientation:!0,label:{position:"left"},colLimit:31,tooltip:!0,legend:[1,2,3,4],highlight:new Date,itemName:["match","matches"],subDomainTextFormat:function(a,b){return b},cellSize:13,domainGutter:5,previousSelector:"#prev",nextSelector:"#next",legendHorizontalPosition:"right"});var l=["Matches"];for(var h in e)l.push(e[h].games);console.log(e),console.log(f),c3.generate({bindto:"#chart-days",data:{columns:[l],type:"bar",color:function(a,c){return b(a,c,e)}},bar:{width:{ratio:.9}},axis:{x:{type:"category",categories:moment.weekdays()}},tooltip:{format:{value:function(a,b,c,d){return a+" ("+(e[d]&&e[d].win?e[d].win/e[d].games*100:0).toFixed(2)+"%)"}}}});var m=["Matches"];for(var h in f)m.push(f[h].games);c3.generate({bindto:"#chart-hours",data:{columns:[m],type:"bar",color:function(a,c){return b(a,c,f)}},bar:{width:{ratio:.9}},axis:{x:{type:"category",categories:m.slice(1).map(function(a,b){return moment().startOf("day").hours(b).format("ha")})}},tooltip:{format:{value:function(a,b,c,d){return a+" ("+(f[d]&&f[d].win?f[d].win/f[d].games*100:0).toFixed(2)+"%)"}}}})}function generateCharts(a){c3.generate({bindto:"#chart-gold-breakdown",data:{columns:a.goldCols,type:"bar",order:"desc",groups:[a.gold_reasons]},bar:{width:{ratio:.9}},axis:{x:{type:"category",categories:a.cats}}});var b=a.difference,c=a.gold,d=a.xp,e=a.lh,f=[{bindTo:"#chart-diff",columns:b,x:"time",type:"area-spline",xLabel:"Game Time (minutes)",yLabel:"Radiant Advantage"},{bindTo:"#chart-gold",columns:c,x:"time",type:"spline",xLabel:"Game Time (minutes)",yLabel:"Gold"},{bindTo:"#chart-xp",columns:d,x:"time",type:"spline",xLabel:"Game Time (minutes)",yLabel:"XP"},{bindTo:"#chart-lh",columns:e,x:"time",type:"spline",xLabel:"Game Time (minutes)",yLabel:"LH"}];f.forEach(function(a){c3.generate({bindto:a.bindTo,data:{x:a.x,columns:a.columns,type:a.type},axis:{x:{type:"timeseries",tick:{format:function(a){return moment().startOf("day").seconds(a).format("H:mm")}},label:a.xLabel},y:{label:a.yLabel}},tooltip:{contents:function(a,b,c,d){return a.sort(function(a,b){return b.value-a.value}),this.getTooltipContent(a,b,c,d)}}})})}function formatHtml(){$("table.summable").each(function(a,b){var c={Radiant:{},Dire:{}},d={},e=$(b).find("tbody");e.children().each(function(a,b){b=$(b);var e=b.hasClass("success")?c.Radiant:c.Dire;b.children().each(function(a,b){b=$(b),e[a]||(e[a]=0),d[a]=b.hasClass("negative");var c=b.clone().children().remove().end().text();e[a]+=Number(c)||0})});var f=$("<tfoot>");for(var g in c){var h=$("<tr>"),i=c[g];i[0]=g;for(var j in i){var k=$("<td>");"0"!==j&&k.addClass("format"),k.text(i[j]);var l="Radiant"===g?"Dire":"Radiant",m=i[j]>c[l][j];m=d[j]?i[j]<c[l][j]:m,m&&k.addClass("Radiant"===g?"success":"danger"),h.append(k)}f.append(h)}$(b).append(f)}),$(".format").each(function(){$(this).text(format($(this).text()))}),$(".fromNow").each(function(){$(this).text(moment.unix($(this).text()).fromNow())}),$(".format-seconds").each(function(){$(this).text(formatSeconds($(this).attr("data-format-seconds")))})}function generateHistograms(a){function b(a,b,c,d){var e=Array.apply(null,new Array(c+1)).map(Number.prototype.valueOf,0);Object.keys(a).forEach(function(c){var d=~~(Number(c)*b);e[d]+=a[c]}),c3.generate({bindto:"#chart-histogram",data:{columns:[["Matches"].concat(e)],type:"bar"},bar:{width:{ratio:.8}},axis:{x:{label:d,tick:{format:function(a){a=Number(a)/b;var c={duration:1,first_blood_time:1};return c[d]?moment().startOf("day").seconds(a).format("H:mm:ss"):a.toFixed(0)}}},y:{label:"Matches"}}})}$(".histogram").on("click",function(){var c=$(this).attr("data-histogram"),d=a[c].counts,e=Math.max.apply(null,Object.keys(d).map(function(a){return Number(a)})),f=~~Math.min(80,e),g=f/e;b(d,g,f,c)}),$(".histogram").first().trigger("click")}function buildMap(){$(document).on("ready",function(){var a=[{id:"t4br",style:"position: absolute; top: 78%; left: 17%;"},{id:"t4tr",style:"position: absolute; top: 77%; left: 15%;"},{id:"t3br",style:"position: absolute; top: 86%; left: 26%;"},{id:"t2br",style:"position: absolute; top: 86%; left: 43%;"},{id:"t1br",style:"position: absolute; top: 86%; left: 80%;"},{id:"t3mr",style:"position: absolute; top: 72%; left: 22%;"},{id:"t2mr",style:"position: absolute; top: 64%; left: 30%;"},{id:"t1mr",style:"position: absolute; top: 56%; left: 38%;"},{id:"t3tr",style:"position: absolute; top: 67%; left: 9%;"},{id:"t2tr",style:"position: absolute; top: 50%; left: 9%;"},{id:"t1tr",style:"position: absolute; top: 40%; left: 9%;"},{id:"brbr",style:"position: absolute; top: 85%; left: 24%;"},{id:"bmbr",style:"position: absolute; top: 87%; left: 24%;"},{id:"brmr",style:"position: absolute; top: 73%; left: 18%;"},{id:"bmmr",style:"position: absolute; top: 74%; left: 20%;"},{id:"brtr",style:"position: absolute; top: 69%; left: 8%;"},{id:"bmtr",style:"position: absolute; top: 69%; left: 10%;"},{id:"t4bd",style:"position: absolute; top: 19%; left: 83%;"},{id:"t4td",style:"position: absolute; top: 18%; left: 81%;"},{id:"t3bd",style:"position: absolute; top: 31%; left: 87%;"},{id:"t2bd",style:"position: absolute; top: 45%; left: 87%;"},{id:"t1bd",style:"position: absolute; top: 60%; left: 87%;"},{id:"t3md",style:"position: absolute; top: 27%; left: 73%;"},{id:"t2md",style:"position: absolute; top: 37%; left: 63%;"},{id:"t1md",style:"position: absolute; top: 47%; left: 53%;"},{id:"t3td",style:"position: absolute; top: 13%; left: 70%;"},{id:"t2td",style:"position: absolute; top: 13%; left: 50%;"},{id:"t1td",style:"position: absolute; top: 13%; left: 20%;"},{id:"brbd",style:"position: absolute; top: 29%; left: 86%;"},{id:"bmbd",style:"position: absolute; top: 29%; left: 88%;"},{id:"brmd",style:"position: absolute; top: 25%; left: 74%;"},{id:"bmmd",style:"position: absolute; top: 26%; left: 76%;"},{id:"brtd",style:"position: absolute; top: 12%; left: 72%;"},{id:"bmtd",style:"position: absolute; top: 14%; left: 72%;"},{id:"ar",style:"position: absolute; top: 79%; left: 12%;"},{id:"ad",style:"position: absolute; top: 14%; left: 83%;"}],b=pad(Number($("#map").attr("data-tower-radiant")).toString(2),11);b+=pad(Number($("#map").attr("data-barracks-radiant")).toString(2),6),b+=pad(Number($("#map").attr("data-tower-dire")).toString(2),11),b+=pad(Number($("#map").attr("data-barracks-dire")).toString(2),6),b+="1"===$("#map").attr("data-radiant-win")?"10":"01";for(var c=0;c<b.length;c++){var d=a[c];d.src="https://raw.githubusercontent.com/kronusme/dota2-api/master/images/map/",d.src+="t"===a[c].id.slice(0,1)?"tower":"racks",d.src+="r"===a[c].id.slice(-1)?"_radiant.png":"_dire.png",d["class"]="a"===a[c].id.slice(0,1)?"":"icon",d.style+="1"===b[c]?"":"opacity: 0.2;",$("#map").append($("<img>",d))}})}function playerMatches(a){$.fn.serializeObject=function(){var a={},b=this.serializeArray();return $.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a},$("#hero_id").select2({maximumSelectionSize:1}),$("#with_account_id").select2({tags:a||[],maximumSelectionSize:10}),$("#teammate_hero_id").select2({maximumSelectionSize:4}),$("#enemy_hero_id").select2({maximumSelectionSize:5}),$("form").submit(function(){}),$(".form-control").on("change",function(){});$("#matches").on("xhr.dt",function(a,b,c){console.log(c);var d=(c.aggData.win/c.aggData.games*100).toFixed(2);$("#winrate").text(d+"%").width(d+"%")}).dataTable({order:[[0,"desc"]],serverSide:!0,ajax:{url:"/api/matches",data:function(a){a.select=$("form").serializeObject(),a.agg={win:1,lose:1,games:1}}},deferRender:!0,rowCallback:function(a,b){$(a).addClass(b.player_win?"success":"danger")},drawCallback:function(){tooltips(),formatHtml()},stateSave:!0,searching:!1,processing:!0,columns:[{data:"match_id",title:"Match ID",render:function(a){return'<a href="/matches/'+a+'">'+a+"</a>"}},{data:"players[0].hero_id",title:"Hero",orderData:[2],render:function(a){return constants.heroes[a]?"<img src='"+constants.heroes[a].img+"' title=\""+constants.heroes[a].localized_name+'"/>':a}},{data:"players[0].hero_id",title:"Hero Name",visible:!1,render:function(a){return constants.heroes[a]?constants.heroes[a].localized_name:a}},{data:"player_win",title:"Result",render:function(a){return a?"Won":"Lost"}},{data:"game_mode",title:"Game Mode",render:function(a){return constants.modes[a]?constants.modes[a].name:a}},{data:"cluster",title:"Region",render:function(a){return constants.regions[a]?constants.regions[a]:a}},{data:"duration",title:"Duration",render:function(a){return moment().startOf("day").seconds(a).format("H:mm:ss")}},{data:"start_time",title:"Played",render:function(a,b,c){return moment.unix(a+c.duration).fromNow()}},{data:"players[0].kills",title:"K",render:function(a){return a}},{data:"players[0].deaths",title:"D",render:function(a){return a}},{data:"players[0].assists",title:"A",render:function(a){return a}},{data:"players[0].last_hits",title:"LH",render:function(a){return a}},{data:"players[0].denies",title:"DN",render:function(a){return a}},{data:"players[0].gold_per_min",title:"GPM",render:function(a){return a}},{data:"players[0].xp_per_min",title:"XPM",render:function(a){return a}},{data:"players[0].hero_damage",title:"HD",render:function(a){return a}},{data:"players[0].tower_damage",title:"TD",render:function(a){return a}},{data:"players[0].hero_healing",title:"HH",render:function(a){return a}},{data:"parse_status",title:"Status",render:function(a){return constants.parse_status[a]?constants.parse_status[a]:a}}]})}function playerTrendsTables(){var a=$("#accuracy").dataTable({searching:!0,paging:!0,order:[[2,"desc"]],drawCallback:function(){tooltips(),formatHtml()},columnDefs:[{targets:[0],orderData:[1]},{targets:[1],visible:!1}]}),b=$("#builds").dataTable({paging:!0,order:[[2,"asc"]],drawCallback:function(){tooltips(),formatHtml()},columns:[{},{},{render:function(a,b){return"display"===b?formatSeconds(a):a}},{}],columnDefs:[{targets:[0],orderData:[1]},{targets:[1],visible:!1}]}),c=$("#teammates").dataTable({paging:!0,order:[[1,"desc"]]}),d=$("#heroes").dataTable({paging:!0,order:[[2,"desc"]],drawCallback:function(){tooltips(),formatHtml()},columnDefs:[{targets:[0],orderData:[1]},{targets:[1],visible:!1}]});return[a,b,c,d]}function ratingsChart(a){$("#solo").append(a[0]?a[0].soloCompetitiveRank:"N/A"),$("#party").append(a[0]?a[0].competitiveRank:"N/A");var b=a.map(function(a){return new Date(a.time)}),c=a.map(function(a){return a.soloCompetitiveRank}),d=a.map(function(a){return a.competitiveRank});c3.generate({bindto:"#ratings",data:{x:"x",columns:[["x"].concat(b),["Solo"].concat(c),["Party"].concat(d)],type:"line"},axis:{x:{type:"timeseries",label:"Date",tick:{format:"%Y-%m-%d",count:10}},y:{label:"Rating"}}})}function statusHandler(){function a(a){for(var b in a)if("object"==typeof a[b]){$("#"+b+" tbody").empty();for(var c=0;c<a[b].length;c++)$("<tr><td><a href='/matches/"+a[b][c].match_id+"'>"+a[b][c].match_id+"</a></td><td class='fromNowAttr' time='"+(a[b][c].start_time+a[b][c].duration)+"'></td></tr>").appendTo($("#"+b+" tbody"));$(".fromNowAttr").each(function(){$(this).text(moment.unix($(this).attr("time")).fromNow())})}else $("#"+b).html(a[b])}a(data)}function generateTimeline(a){$(document).on("ready",function(){for(var b in a.parsed_data.heroes){var c=[],d=0,e=a.parsed_data.heroes[b];if(!(e.timeline.length<1)){for(var f=0;f<e.timeline.length;f++){var g=e.timeline[f],h={},i=formatSeconds(g.time);i="<div style='font-size:10px;'>"+i+"<div>",h.start=moment().startOf("day").seconds(g.time),"itembuys"==g.type&&(h.content=g.key,h.group=1,c.push(h)),"hero_history"==g.type&&(h.className="background-"+d%10,d+=1,h.content=g.key,h.start=moment().startOf("day").seconds(g.time),h.end=moment().startOf("day").seconds(g.end),h.type="background",h.group=1,c.push(h))}var j=[{id:0,content:"Hero"},{id:1,content:"Item"}],k=document.getElementById("timeline"),l={zoomable:!1,moveable:!1,showCurrentTime:!1,margin:{item:2},padding:1,start:moment().startOf("day").subtract(300,"seconds"),end:moment().startOf("day").seconds(a.duration).add(180,"seconds"),showMajorLabels:!1,showMinorLabels:!1},m=new vis.Timeline(k);m.setOptions(l),m.setItems(c),m.setGroups(j)}}})}function tooltips(){$(".item").qtip({content:{text:function(a,b){return $.ajax({url:"/api/items",data:{name:$(this).attr("alt")}}).then(function(a){var c=$("<div/>");c.append(a.cost?$("<div/>",{html:'<img alt="Gold Cost" title="Gold Cost" class="goldImg" src="http://cdn.dota2.com/apps/dota2/images/tooltips/gold.png" width="16" height="16" border="0" />'+a.cost}):""),c.append(a.desc?$("<div/>",{html:a.desc}):""),c.append(a.notes?$("<div/>",{html:a.notes}):""),c.append(a.attrib?$("<div/>",{html:a.attrib}):""),c.append(a.mc?$("<div/>",{html:'<img alt="Mana Cost" title="Mana Cost" class="manaImg" src="http://cdn.dota2.com/apps/dota2/images/tooltips/mana.png" width="16" height="16" border="0" />'+a.mc}):""),c.append(a.cd?$("<div/>",{html:'<img alt="Cooldown" title="Cooldown" class="cooldownImg" src="http://cdn.dota2.com/apps/dota2/images/tooltips/cooldown.png" width="16" height="16" border="0" />'+a.cd}):""),c.append(a.lore?$("<div/>",{html:a.lore}):""),b.set("content.text",c.html()),b.set("content.title",a.dname)},function(a,c,d){b.set("content.text",c+": "+d)}),"Loading..."}},style:"qtip-dark"}),$(".ability").qtip({content:{text:function(a,b){return $.ajax({url:"/api/abilities",data:{name:$(this).attr("alt")}}).then(function(a){var c=$("<div/>");c.append(a.affects?$("<div/>",{html:a.affects}):""),c.append(a.desc?$("<div/>",{html:a.desc}):""),c.append(a.notes?$("<div/>",{html:a.notes}):""),c.append(a.attrib?$("<div/>",{html:a.attrib}):""),c.append(a.dmg?$("<div/>",{html:a.dmg}):""),c.append(a.cmb?$("<div/>",{html:a.cmb}):""),c.append(a.lore?$("<div/>",{html:a.lore}):""),b.set("content.text",c.html()),b.set("content.title",a.dname)},function(a,c,d){b.set("content.text",c+": "+d)}),"Loading..."}},style:"qtip-dark"}),$("[title]").qtip({style:"qtip-dark"})}function format(a){return a=Number(a),0===a||isNaN(a)?"-":Math.abs(a)<1e3?~~a:numeral(a).format("0.0a")}function pad(a,b,c){return c=c||"0",a+="",a.length>=b?a:new Array(b-a.length+1).join(c)+a}function formatSeconds(a){var b=Math.abs(a),c=~~(b/60),d=pad(~~(b%60),2),e=0>a?"-":"";return e+=c+":"+d}!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-55757642-1","auto"),ga("require","displayfeatures"),ga("send","pageview");