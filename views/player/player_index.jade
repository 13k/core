extend player

include /mixins/hero_table
include /mixins/teammate_table

block playercontent
  if typeof player.account_id === "number"
    .row.match-top 
      .col-md-1
        img(src='#{player.avatarmedium}').img-thumbnail
      .col-md-4
        h1= player.personaname || player.account_id
      .col-md-1
        if player.cheese
          i.flaticon-1.medium-cheese(style="display:inline-block")
          div.text-right x#{player.cheese}
      .col-md-6
        table.table.table-condensed
          thead
            tr
              //th Record
              th Full History
              th Name Update
              th Last Visit
          tbody
            tr
              //td <span class="green">#{player.aggData.win}</span>-<span class="red">#{player.aggData.lose}</span> <br> (#{player.aggData.games ? (player.aggData.win/player.aggData.games*100).toFixed(2) : "0.00"}%)
              td=(player.full_history_time ? moment(player.full_history_time).fromNow() : "never")
              td=(player.last_summaries_update ? moment(player.last_summaries_update).fromNow() : "never")
              td #{(player.last_visited ? moment(player.last_visited).fromNow() : "never")} <br> (#{(player.account_id in trackedPlayers) ? "tracked" : "untracked"})
    if (user && user.account_id === player.account_id)
      .row
        .col-md-12
          if (!user.full_history_time)
            .alert.alert-danger We're watching your games and parsing them from now on, but we don't have your old matches yet!  Check back later to see if we've gotten your full history.
          if (!ratingPlayers[user.account_id])
            .alert.alert-info Want to include your MMR on your profile and be eligible for the leaderboard? 
              a.alert-link(href="http://steamcommunity.com/profiles/"+ (bots[0] ? bots[0].steamID : "")) Add a tracker.
          .checkbox
            label
              input.pref#theme(type="checkbox", checked=user.light_theme)
              | Use Light Theme
    //result, W-L
    .row
      .col-md-12
        table.table
          tr
            th Record
            th Win%
          tr
            td#record
            td
              .progress
                .progress-bar.progress-bar-success#winrate
                
  //query form and matches
  .row
     .col-md-12
       include /query
  .row
    .col-md-12.table-responsive
      h3 Matches
      table.table#matches

  hr
  .row
    include /ads/leaderboard_2
    
  if typeof player.account_id === "number"
    hr
    .row
      .col-md-12
        h3 Heroes
        table.table#heroes
        //+hero_table(player.heroes_arr, true)
    hr
    .row
      .col-md-6
        h3 Teammates
        table.table#teammates
        //+teammate_table(player.teammates)
      .col-md-6.match
        h3 Rating
          small.rating#solo Solo:
          small.rating#party Party:
        #ratings
  
append footer_assets
  script.
    var ratings = !{JSON.stringify(player.ratings || [])};
    ratingsChart(ratings);
    $(".pref").change(function() {
        $.post(
            "/preferences", {
                light_theme: $("#theme").is(":checked"),
            },
            function(data) {
                if (data.sync) {
                    location.reload(true);
                }
                else {
                    $(".page-header").after("<div role='alert' class='sync alert alert-warning'>Failed to update preferences. Try again later.</div>");
                }
                $(".sync").fadeOut(3000);
            });
    });